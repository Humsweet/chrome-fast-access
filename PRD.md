# fast-access PRD (Product Requirements Document)

> 简洁高效的新标签页快速拨号 Chrome 扩展

## 产品概述

fast-access 是一个 Chrome 浏览器扩展，替代默认的新标签页，提供简洁的快捷方式网格界面，帮助用户快速访问常用网站。

**设计风格**: Notion 风格（浅色背景、圆角、细微阴影、简洁排版）

**当前版本**: v1.5.1

---

## 功能清单

### 1. 快捷方式管理

#### 1.1 添加快捷方式
- **入口**: 点击网格末尾的「+」按钮
- **弹窗内容**:
  - 名称（必填）
  - URL（必填，自动补全 https://）
  - 图标（可选，仅支持 SVG）
- **图标设置** (v1.5.1+):
  - 「粘贴 SVG 代码」按钮：打开弹窗粘贴 SVG 代码
  - 「上传 SVG」按钮：选择本地 SVG 文件上传
  - 图标预览：设置图标后显示预览
  - 清除按钮：移除已设置的图标
  - 大小限制：单个 SVG 建议 7KB 以内，超出时提示用户
- **图标来源推荐**: [Simple Icons](https://simpleicons.org/) 获取品牌图标

#### 1.2 编辑快捷方式
- **入口**: 右键点击快捷方式 → 选择「编辑」
- **功能**: 修改名称、URL、图标

#### 1.3 删除快捷方式
- **入口**: 右键点击快捷方式 → 选择「删除」
- **确认**: 弹出确认对话框

#### 1.4 拖拽排序
- **触发方式**: 鼠标直接拖拽（按住即可拖动）
- **视觉反馈**:
  - 被拖拽元素：半透明 + 轻微放大 + 阴影效果
  - 目标位置：左侧蓝色竖线指示器 + 背景高亮
- **保存**: 拖拽完成后自动保存到 Chrome Sync
- **实现文件**: `newtab.js:813-871`, `newtab.css:412-456`

---

### 2. 显示设置

#### 2.1 每行显示数量
- **选项**: 3 / 4 / 5 个
- **默认值**: 4

#### 2.2 图标大小缩放
- **范围**: 0.75x - 1.25x
- **步进**: 0.05
- **默认值**: 1x
- **影响**: 图标尺寸、卡片尺寸、间距、字体大小

---

### 3. 语言设置

#### 3.1 支持语言
| 代码 | 语言 |
|------|------|
| en | English |
| zh-CN | 简体中文 |
| zh-TW | 繁體中文 |
| ja | 日本語 |
| es | Español |

#### 3.2 语言检测
- 优先使用用户保存的设置
- 其次根据浏览器语言自动检测
- 默认回退到英语

---

### 4. 数据管理

#### 4.1 导出配置
- **格式**: JSON 文件
- **文件名**: `speed-dial-backup-YYYY-MM-DD.json`
- **内容**: 所有快捷方式和设置

#### 4.2 导入配置
- **支持格式**:
  - 本应用导出的配置文件
  - Speed Dial 2 配置文件（自动检测并转换）
- **导入方式**（网页内弹窗选择）:
  - 「追加到现有」- 将导入的快捷方式添加到现有列表末尾
  - 「替换全部」- 用导入的快捷方式替换现有列表
- **实现文件**: `newtab.js:463-511`, `newtab.html:228-254`, `newtab.css:872-904`

#### 4.3 重置所有数据
- **功能**: 清除所有快捷方式和设置，恢复默认状态
- **确认**: 弹出确认对话框
- **默认快捷方式**: Google, YouTube, GitHub, Twitter

---

### 5. 同步功能

#### 5.1 存储策略
- **主存储**: Chrome Storage Sync API（跨设备同步）
- **备份存储**: Chrome Storage Local（本地备份）
- **回退机制**: 同步失败时自动保存到本地

#### 5.2 分片存储（v1.5.0+）
为突破 Chrome Storage Sync 单项 8KB 限制，采用数据分片存储：

**存储结构**:
```
{
  "dials_meta": { count: 50, chunks: 3, version: 2 },
  "dials_0": [item 0-16],    // ~7KB
  "dials_1": [item 17-33],   // ~7KB
  "dials_2": [item 34-50],   // ~7KB
  "settings": {...}
}
```

**容量对比**:
| 指标 | 之前 | 之后 |
|------|------|------|
| 最大存储 | 8 KB | ~90 KB（留 10KB 给 settings）|
| 快捷方式数量 | ~10-20 个（带 SVG）| ~100+ 个（带 SVG）|
| 同步能力 | 数据过大时降级本地 | 始终可同步 |

**实现方法**:
- `saveDialsInChunks()`: 将 dials 按 7KB 分片存储
- `loadDialsFromChunks()`: 从分片加载并合并 dials
- `cleanupOldChunks()`: 清理多余分片和旧格式数据
- 导出时自动合并为简单格式，保持兼容性

#### 5.3 存储限制
- 总容量: 100KB
- 单项最大: 8KB（通过分片规避）
- 分片大小: 7KB（留 1KB 缓冲）
- 超出 90KB 总量时仅保存到本地并提示用户

#### 5.4 同步状态检查
- 显示同步存储使用量
- 显示本地存储使用量
- 显示同步状态（正常/无数据/访问失败）
- 显示分片数量（新格式）

---

## 技术架构

### 文件结构
```
chrome-fast-access/
├── manifest.json      # Chrome 扩展配置
├── newtab.html        # 新标签页 HTML
├── newtab.css         # 样式文件
├── newtab.js          # 主逻辑（SpeedDial 类）
├── i18n.js            # 国际化模块
└── icons/             # 扩展图标
    ├── icon16.png/svg
    ├── icon48.png/svg
    └── icon128.png/svg
```

### 核心组件
- **SpeedDial 类** (`newtab.js`): 主控制器，管理所有功能
- **i18n 模块** (`i18n.js`): 国际化支持
- **Modal 组件**: 添加/编辑快捷方式弹窗
- **Settings Modal**: 设置弹窗（左侧导航 + 右侧内容）
- **Import Modal**: 导入选项弹窗
- **Context Menu**: 右键菜单

### CSS 设计令牌
```css
--bg-color: #fbfbfa;
--card-bg: rgba(55, 53, 47, 0.04);
--card-hover-bg: rgba(55, 53, 47, 0.08);
--text-color: #37352f;
--text-secondary: #6b6b6b;
--accent-color: #2383e2;
--border-color: rgba(55, 53, 47, 0.09);
--border-radius: 8px;
```

---

## 版本历史

### v1.5.1 (2026-01-22)
**新功能**:
- 新增上传 SVG 文件功能，替代原有的 textarea 输入
- 添加/编辑快捷方式时显示图标预览
- 「粘贴 SVG 代码」和「上传 SVG」两个按钮，样式与设置页面一致

**技术细节**:
- 新增粘贴 SVG 弹窗（`pasteSvgModal`）
- 新增图标预览区域（`iconPreview`）
- SVG 大小验证，超过 7KB 时提示用户
- 支持 5 种语言的新增文本翻译

**实现文件**: `newtab.html:34-60`, `newtab.js:334-456`, `newtab.css:956-1020`

### v1.5.0 (2026-01-22)
**核心改进**:
- 实现数据分片存储，突破 Chrome Sync 8KB 单项限制
- 支持存储 100+ 个带 SVG 图标的快捷方式
- 向后兼容旧格式数据，自动迁移

**技术细节**:
- 新增 `saveDialsInChunks()` 方法：按 7KB 分片存储
- 新增 `loadDialsFromChunks()` 方法：合并分片加载
- 新增 `cleanupOldChunks()` 方法：清理旧数据
- 导出配置自动合并为简单格式，保持兼容性
- 同步状态显示分片信息

**实现文件**: `newtab.js:664-762`

### v1.4.0 (2026-01-22)
**功能改进**:
- 导入配置时使用网页内弹窗替代浏览器原生 confirm 对话框
- 弹窗提供明确的「追加到现有」和「替换全部」两个按钮

**新功能**:
- 拖拽排序增强（Notion 风格视觉反馈）
  - 被拖拽元素：半透明 + 阴影效果
  - 目标位置：蓝色竖线指示器

### v1.3.0
- 支持导入 Speed Dial 2 配置文件
- 优化数据管理界面

### v1.2.0
- 新增多语言支持（5种语言）

### v1.1.0
- 移除搜索栏功能，专注于快捷方式
- 移除时钟显示，界面更简洁
- 修复每行显示数量设置不生效的问题
- 优化设置页面布局

### v1.0.0
- 初始版本
- 基础快捷方式管理
- Chrome Sync 同步支持

---

## 待办/未来计划

_（根据用户反馈添加）_

---

## 相关链接

- **品牌图标资源**: https://simpleicons.org/
